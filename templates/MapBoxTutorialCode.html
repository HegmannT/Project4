
<!DOCTYPE html>
<html>
	<!-- The following code is copied from the Mapbox Turf tutorial -->
	<!-- https://docs.mapbox.com/help/tutorials/analysis-with-turf/#add-turf -->
	<!-- The purpose of this is to try an dreverse engineer to understand how the code works, and see if it can run -->
	<!-- This will NOT be submitted with the final lab hand it, its here as a reference/comparison trying to figure out how turf works -->

  <head>
	

    <meta charset="utf-8" />
    <title></title>
    <meta name="robots" content="noindex, nofollow" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js"></script>
    <link
      href="https://api.tiles.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css"
      rel="stylesheet"
    />
    <script src="https://api.mapbox.com/mapbox.js/plugins/turf/v3.0.11/turf.min.js"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      mapboxgl.accessToken = 'pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg';
      var map = new mapboxgl.Map({
        container: 'map', // container id
        style: 'mapbox://styles/mapbox/light-v10', //stylesheet location
        center: [-114.0719, 51.0447], // starting position
        zoom: 12 // starting zoom
      });


	{% for schoolsearchresults in schoolsearchresults%}
			var hospit = {
		        'type': 'FeatureCollection',
		        'features': [
		          {
		            'type': 'Feature',
		            'properties': {
		              'Name': 'VA Medical Center -- Leestown Division',
		              'Address': '2250 Leestown Rd'
		            },
		            'geometry': {
		              'type': 'Point',
		              'coordinates': [-114.70719, 51.50447]
		            }
		          }

	{% endfor %}





      var hospitals = {
        'type': 'FeatureCollection',
        'features': [
          {
            'type': 'Feature',
            'properties': {
              'Name': 'VA Medical Center -- Leestown Division',
              'Address': '2250 Leestown Rd'
            },
            'geometry': {
              'type': 'Point',
              'coordinates': [-114.70719, 51.50447]
            }
          },
          {
            'type': 'Feature',
            'properties': {
              'Name': 'St. Joseph East',
              'Address': '150 N Eagle Creek Dr'
            },
            'geometry': {
              'type': 'Point',
              'coordinates': [-114.10719, 51.00447]
            }
          },
          {
            'type': 'Feature',
            'properties': {
              'Name': 'Central Baptist Hospital',
              'Address': '1740 Nicholasville Rd'
            },
            'geometry': {
              'type': 'Point',
              'coordinates': [-114.062719, 51.067447]
            }
          },
          {
            'type': 'Feature',
            'properties': {
              'Name': 'VA Medical Center -- Cooper Dr Division',
              'Address': '1101 Veterans Dr'
            },
            'geometry': {
              'type': 'Point',
              'coordinates': [-114.01719, 51.01447]
            }
          },
          {
            'type': 'Feature',
            'properties': {
              'Name': 'Shriners Hospital for Children',
              'Address': '1900 Richmond Rd'
            },
            'geometry': {
              'type': 'Point',
              'coordinates': [-114.02719, 51.08447]
            }
          },
          {
            'type': 'Feature',
            'properties': {
              'Name': 'Eastern State Hospital',
              'Address': '627 W Fourth St'
            },
            'geometry': {
              'type': 'Point',
              'coordinates': [-114.30719, 51.10447]
            }
          },
          {
            'type': 'Feature',
            'properties': {
              'Name': 'Cardinal Hill Rehabilitation Hospital',
              'Address': '2050 Versailles Rd'
            },
            'geometry': {
              'type': 'Point',
              'coordinates': [-114.80719, 51.08447]
            }
          },
          {
            'type': 'Feature',
            'properties': {
              'Name': 'St. Joseph Hospital',
              'ADDRESS': '1 St Joseph Dr'
            },
            'geometry': {
              'type': 'Point',
              'coordinates': [-114.042719, 51.04447]
            }
          },
          {
            'type': 'Feature',
            'properties': {
              'Name': 'UK Healthcare Good Samaritan Hospital',
              'Address': '310 S Limestone'
            },
            'geometry': {
              'type': 'Point',
              'coordinates': [-114.07319, 51.0442447]
            }
          },
          {
            'type': 'Feature',
            'properties': {
              'Name': 'UK Medical Center',
              'Address': '800 Rose St'
            },
            'geometry': {
              'type': 'Point',
              'coordinates': [-114.90719, 51.20447]
            }
          }
        ]
      };
      var libraries = {
        'type': 'FeatureCollection',
        'features': [
          {
            'type': 'Feature',
            'properties': {
              'Name': 'Village Branch',
              'Address': '2185 Versailles Rd'
            },
            'geometry': {
              'type': 'Point',
              'coordinates': [-114.20719, 51.0447]
            }
          },
          {
            'type': 'Feature',
            'properties': {
              'Name': 'Northside Branch',
              'ADDRESS': '1733 Russell Cave Rd'
            },
            'geometry': {
              'type': 'Point',
              'coordinates': [-114.60719, 51.50447]
            }
          },
          {
            'type': 'Feature',
            'properties': {
              'Name': 'Central Library',
              'ADDRESS': '140 E Main St'
            },
            'geometry': {
              'type': 'Point',
              'coordinates': [-114.40719, 51.30447]
            }
          },
          {
            'type': 'Feature',
            'properties': {
              'Name': 'Beaumont Branch',
              'Address': '3080 Fieldstone Way'
            },
            'geometry': {
              'type': 'Point',
              'coordinates': [-114.04719, 51.9447]
            }
          },
          {
            'type': 'Feature',
            'properties': {
              'Name': 'Tates Creek Branch',
              'Address': '3628 Walden Dr'
            },
            'geometry': {
              'type': 'Point',
              'coordinates': [-114.10719, 51.30447]
            }
          },
          {
            'type': 'Feature',
            'properties': {
              'Name': 'Eagle Creek Branch',
              'Address': '101 N Eagle Creek Dr'
            },
            'geometry': {
              'type': 'Point',
              'coordinates': [-114.03719, 51.04447]
            }
          }
        ]
      };

      map.on('load', function () {
        map.addLayer({
          id: 'hospitals',
          type: 'symbol',
          source: {
            type: 'geojson',
            data: hospitals
          },
          layout: {
            'icon-image': 'hospital-15',
            'icon-allow-overlap': true
          },
          paint: {}
        });

        map.addLayer({
          id: 'libraries',
          type: 'symbol',
          source: {
            type: 'geojson',
            data: libraries
          },
          layout: {
            'icon-image': 'library-15',
            'icon-allow-overlap': true
          },
          paint: {}
        });

        map.addSource('nearest-hospital', {
          type: 'geojson',
          data: {
            'type': 'FeatureCollection',
            'features': []
          }
        });
      });

      var popup = new mapboxgl.Popup();

      map.on('mousemove', function (e) {
        var features = map.queryRenderedFeatures(e.point, {
          layers: ['hospitals', 'libraries']
        });
        if (!features.length) {
          popup.remove();
          return;
        }

        var feature = features[0];

        popup
          .setLngLat(feature.geometry.coordinates)
          .setHTML(feature.properties.Name)
          .addTo(map);

        map.getCanvas().style.cursor = features.length ? 'pointer' : '';
      });

      map.on('click', function (e) {
        var libraryFeatures = map.queryRenderedFeatures(e.point, {
          layers: ['libraries']
        });
        if (!libraryFeatures.length) {
          return;
        }

        var libraryFeature = libraryFeatures[0];

        var nearestHospital = turf.nearest(libraryFeature, hospitals);

        if (nearestHospital != null) {
          map.getSource('nearest-hospital').setData({
            'type': 'FeatureCollection',
            'features': [nearestHospital]
          });

          map.addLayer(
            {
              id: 'nearest-hospital',
              type: 'circle',
              source: 'nearest-hospital',
              paint: {
                'circle-radius': 12,
                'circle-color': '#486DE0'
              }
            },
            'hospitals'
          );
        }
      });
    </script>
  </body>
</html>
